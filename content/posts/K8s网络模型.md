---
title: "Kubernetes网络模型：Overlay和Underlay"
date: 2021-09-21T19:34:03+08:00
draft: true
tags: ["K8s", "网络"]
categories: ["K8s"]
summary: 站在CPU高速缓存的角度，分析Cache伪共享在Golang执行效率上的影响。
typora-root-url: ../../static
---

## 资料

Underlay/Overlay

- Underlay 的标准是它与 Host 网络是同层的，从外在可见的一个特征就是它是不是使用了 Host 网络同样的网段、输入输出基础设备、容器的 IP 地址是不是需要与 Host 网络取得协同（来自同一个中心分配或统一划分）。这就是 Underlay；
- Overlay 不一样的地方就在于它并不需要从 Host 网络的 IPM 的管理的组件去申请 IP，一般来说，它只需要跟 Host 网络不冲突，这个 IP 可以自由分配的。

## 基础知识

### 网络设备解释

- 集线器（hub）

- - 一个口收到的信号，原封不动的发送给所有其他的口，由其他的口上的设备自己决定是否接收信号。有点类似广播，但是比广播更纯粹。由于hub只是简单的转发，所以hub工作在物理层（L1）。

- 网桥（bridge）

- - 工作在数据链路层（L2）。以太网中，数据链路层地址就是mac地址，网桥与hub的区别在于，网桥会过滤mac，只有目的mac地址匹配的数据才会发送到出口。一个bridge指的是一个输入到一个输出的桥接。

- 交换机（switch）

- - 早期的switch，其实可以看成多个bridge的集成设备，因此也工作在数据链路层。一个交换机口的输入到另一个交换机口的输出，可以认为是一个bridging。交换机中的MAC table，实际是为了bridge能工作而存在。一个N口交换机可以看成是`N * (N - 1)`个网桥的集合。
  - 但是事情也不是绝对的，随着技术的发展，也常常听到L3 Switch，也就是说switch也可以包含routing功能。

- 路由器（router）

- - 工作在网络层（L3），基于IP地址做转发。

通俗的说，网桥就是一个二层桥接设备，桥接（bridging）就是把桥的两端连接起来，但不是所有的流量都放行，只有目的MAC地址（二层）匹配的才放行。

容易混淆的是网桥和交换机的概念，现在普遍认为的交换机可以同时具有bridging和routing两种功能。其中bridging与网桥相关，这上面解释过了。交换机更像是一个兼顾二层，三层的设备。
